<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Pic-Man</title>
    <style>
      body {
        margin: 0;
        background-color: black;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        font-family: 'Press Start 2P', cursive;
        overflow: hidden;
        position: relative;
        perspective: 1000px; /* Perspective for 3D effect */
      }

      .container {
        position: relative;
        width: max-content;
      }

      .poster {
        max-width: 500px;
        width: 90%;
        display: block;
      }

      .InsertCoin {
        position: absolute;
        left: 47%;
        top: 85%;
        transform: translate(-50%, -50%);
        width: 300px;
        cursor: default;
        z-index: 2;
        transition: transform 0.2s ease;
      }

      .InsertCoin:hover {
        transform: translate(-50%, -50%) scale(1.1);
      }

      #muteButton {
        position: absolute;
        top: 70px;
        left: 120px;
        z-index: 99;
        cursor: pointer;
        width: 80px;
        height: 80px;
      }
      
      .piggy {
        position: absolute;
        bottom: 90px;
        left: 20px;
        width: 120px;
        cursor: pointer;
        z-index: 3;
      }

      .coin {
        position: absolute;
        width: 50px;
        height: 50px;
        background: url('images/coin.png') no-repeat center center / contain;
        pointer-events: none;
        z-index: 4;
        display: none;
        transform-origin: center center;
        transform-style: preserve-3d;
      }

      @keyframes coinJumpArc {
        0%   { transform: translate(0px, 0px) rotateY(0deg); opacity: 1; }
        5%   { transform: translate(80px, -60px) rotateY(270deg); }
        10%  { transform: translate(160px, -120px) rotateY(540deg); }
        15%  { transform: translate(240px, -180px) rotateY(810deg); }
        20%  { transform: translate(320px, -240px) rotateY(1080deg); }
        25%  { transform: translate(400px, -290px) rotateY(1350deg); }
        30%  { transform: translate(480px, -300px) rotateY(1620deg); }
        35%  { transform: translate(560px, -290px) rotateY(1890deg); }
        40%  { transform: translate(640px, -270px) rotateY(2160deg); }
        45%  { transform: translate(720px, -240px) rotateY(2430deg); }
        50%  { transform: translate(800px, -200px) rotateY(2700deg); }
        55%  { transform: translate(880px, -160px) rotateY(2970deg); }
        60%  { transform: translate(960px, -120px) rotateY(3240deg); }
        65%  { transform: translate(1040px, -90px) rotateY(3510deg); }
        70%  { transform: translate(1120px, -60px) rotateY(3780deg); }
        75%  { transform: translate(1200px, -40px) rotateY(4050deg); }
        80%  { transform: translate(1280px, -30px) rotateY(4320deg); opacity: 0.9; }
        85%  { transform: translate(1320px, -20px) rotateY(4590deg); opacity: 0.6; }
        90%  { transform: translate(1360px, -10px) rotateY(4860deg); opacity: 0.3; }
        100% { transform: translate(1400px, 0px) rotateY(5400deg); opacity: 0; }
      }

    </style>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  </head>

  <body>
    <img id="muteButton" src="images/unmute.png" alt="Mute" />

    <audio id="bgMusic" loop autoplay>
      <source src="sounds/gameWin.wav" type="audio/wav">
    </audio>

    <div class="container">
      <img id="poster" src="images/posterOFFupdated.gif" alt="Pic-Man Poster" class="poster">
      <img src="images/InsertCoin.png" class="InsertCoin" alt="Insert Coin">
    </div>

    <img src="images/piggybank.png" class="piggy" id="piggy" alt="Piggy Bank">
    <div class="coin" id="coin"></div>

    <script>
      const music = document.getElementById("bgMusic");
      const muteButton = document.getElementById("muteButton");
      const poster = document.getElementById("poster");
      const piggy = document.getElementById("piggy");
      const coin = document.getElementById("coin");

      window.isMuted = localStorage.getItem("isMuted") === "true";
      music.volume = 0.5;
      music.muted = window.isMuted;
      muteButton.src = window.isMuted ? "images/mute.png" : "images/unmute.png";

      muteButton.addEventListener("click", toggleMute);
      document.addEventListener("keydown", (e) => {
        if (e.key.toLowerCase() === "m") toggleMute();
      });

      function toggleMute() {
        window.isMuted = !window.isMuted;
        localStorage.setItem("isMuted", window.isMuted);
        muteButton.src = window.isMuted ? "images/mute.png" : "images/unmute.png";
        music.muted = window.isMuted;
      }

      function initAudio() {
        music.play().catch(() => {
          console.log("Autoplay blocked");
        });
      }
      document.addEventListener('DOMContentLoaded', () => setTimeout(initAudio, 300));
      document.addEventListener('click', initAudio, { once: true });

      function startGame() {
        localStorage.setItem("musicTime", music.currentTime);
        window.location.href = "game.html";
      }

      let ghostModeOn = true;
      poster.addEventListener("click", () => {
        ghostModeOn = !ghostModeOn;
        poster.src = ghostModeOn ? "images/posterONupdated.gif" : "images/posterOFFupdated.gif";
      });

      piggy.addEventListener("click", () => {
        const coin = document.getElementById("coin");
        const piggyRect = piggy.getBoundingClientRect();
        const insertCoin = document.querySelector(".InsertCoin");
        const insertCoinRect = insertCoin.getBoundingClientRect();

        const offsetX = insertCoinRect.left - piggyRect.left;
        const offsetY = insertCoinRect.top - piggyRect.top;

        coin.style.display = "block";
        coin.style.left = piggy.offsetLeft + 30 + "px";
        coin.style.top = piggy.offsetTop + "px";
        coin.style.animation = "coinJumpArc 2s ease-out forwards";

        setTimeout(() => {
          coin.style.display = "none";
          coin.style.animation = "";
          startGame();
        }, 3000);
      });
    </script>
  </body>
</html>
